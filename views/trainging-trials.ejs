<!DOCTYPE html>
<html>
<head>
  <title><%= title %></title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
  <style>
    body { 
      font-family: 'Roboto', Arial, sans-serif; 
      margin: 0; 
      padding: 20px; 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
      color: #333; 
      min-height: 100vh;
    }
    .container { 
      max-width: 1600px; 
      margin: 0 auto; 
      background: white; 
      border-radius: 15px; 
      box-shadow: 0 10px 30px rgba(0,0,0,0.2); 
      padding: 40px; 
      overflow: hidden;
    }
    h1 { 
      color: #2c3e50; 
      text-align: center; 
      margin-bottom: 40px; 
      font-weight: 700; 
      text-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .summary-dashboard {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 40px;
    }
    .summary-card {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      transition: transform 0.3s ease;
    }
    .summary-card:hover { transform: translateY(-5px); }
    .summary-card h3 { margin: 0; font-size: 2em; font-weight: 700; }
    .summary-card p { margin: 5px 0 0; font-size: 1.1em; opacity: 0.9; }
    .graphs-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
      gap: 30px;
      margin-bottom: 40px;
    }
    .graph-section { 
      background: #fff; 
      border-radius: 12px; 
      padding: 25px; 
      box-shadow: 0 6px 20px rgba(0,0,0,0.1); 
      transition: box-shadow 0.3s ease;
    }
    .graph-section:hover { box-shadow: 0 10px 30px rgba(0,0,0,0.15); }
    .graph { 
      width: 100%; 
      height: 500px; 
      border-radius: 8px;
    }
    .training-progress {
      background: #fff;
      border-radius: 12px;
      padding: 25px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.1);
      margin-bottom: 40px;
    }
    .training-progress iframe {
      width: 100%;
      height: 600px;
      border: none;
      border-radius: 8px;
    }
    .metrics-matrix { 
      background: #fff; 
      border-radius: 12px; 
      padding: 25px; 
      box-shadow: 0 6px 20px rgba(0,0,0,0.1); 
      margin-bottom: 40px;
    }
    .metrics-table { 
      width: 100%; 
      border-collapse: collapse; 
      margin-top: 20px; 
      border-radius: 8px;
      overflow: hidden;
    }
    .metrics-table th, .metrics-table td { 
      padding: 18px; 
      text-align: center; 
      border: 1px solid #e0e0e0; 
    }
    .metrics-table th { 
      background: linear-gradient(135deg, #667eea, #764ba2); 
      color: white; 
      font-weight: 600; 
    }
    .best-cell { background-color: #d4edda; color: #155724; font-weight: 600; }
    .worst-cell { background-color: #f8d7da; color: #721c24; font-weight: 600; }
    .explanation {
      background: #e9ecef;
      padding: 20px;
      border-radius: 8px;
      margin-top: 20px;
      font-size: 0.9em;
      line-height: 1.6;
    }
    .explanation h3 { margin-top: 0; color: #495057; }
    @media (max-width: 768px) {
      .graphs-grid { grid-template-columns: 1fr; }
      .summary-dashboard { grid-template-columns: repeat(2, 1fr); }
      .graph { height: 400px; }
      .training-progress iframe { height: 400px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1><%= title %></h1>
    
    <!-- Summary Dashboard -->
    <div class="summary-dashboard">
      <div class="summary-card">
        <h3><%= bestTrial ? bestTrial.accuracy : 'N/A' %></h3>
        <p>Best Accuracy</p>
      </div>
      <div class="summary-card">
        <h3><%= bestTrial ? bestTrial.mae : 'N/A' %></h3>
        <p>Best MAE</p>
      </div>
      <div class="summary-card">
        <h3><%= worstTrial ? worstTrial.accuracy : 'N/A' %></h3>
        <p>Worst Accuracy</p>
      </div>
      
    </div>
    
    <!-- Training Progress Section -->
    <div class="training-progress">
      <h2 style="text-align: center; margin-bottom: 20px; color: #495057;">Model Training Progress</h2>
      <iframe src="/api/training/chart"></iframe>
      <div class="explanation">
        <h3>Why Training Progress Matters?</h3>
        <p>The training progress chart shows how the model's loss decreases over epochs during training. <strong>Training loss</strong> (blue line) indicates how well the model fits the training data, while <strong>validation loss</strong> (orange line) shows performance on unseen data. A good training shows both losses decreasing and converging, indicating effective learning without overfitting. If validation loss increases while training loss decreases, it signals overfittingâ€”requiring adjustments like more data or regularization.</p>
        <p><strong>Chart Explanation:</strong> Lower loss values are better. The chart from the latest training session demonstrates the model's learning curve, helping assess if training was successful.</p>
      </div>
    </div>
    
    <!-- Graphs Grid -->
    <div class="graphs-grid">
      <div class="graph-section">
        <h2 style="text-align: center; margin-bottom: 20px; color: #495057;">Accuracy Comparison</h2>
        <div class="graph" id="barChart"></div>
        <div class="explanation">
          <h3>Why Best vs Worst?</h3>
          <p>The <strong>best trial</strong> is selected based on the highest trial score, which considers accuracy, MAE, and RMSE. It represents the most effective model configuration. The <strong>worst trial</strong> has the lowest score, indicating poorer performance. This bar chart directly compares their accuracies to highlight the improvement potential.</p>
          <p><strong>Graph Explanation:</strong> Green bar shows best trial accuracy; red bar shows worst. Higher bars indicate better prediction reliability.</p>
        </div>
      </div>
      
     
      
      <div class="metrics-matrix">
        <h2 style="text-align: center; margin-bottom: 20px; color: #495057;">Performance Metrics Matrix</h2>
        <table class="metrics-table">
          <thead>
            <tr>
              <th>Metric</th>
              <th>Best Trial</th>
              <th>Worst Trial</th>
              <th>Difference</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>Accuracy (%)</strong></td>
              <td class="best-cell"><%= bestTrial ? bestTrial.accuracy : 'N/A' %></td>
              <td class="worst-cell"><%= worstTrial ? worstTrial.accuracy : 'N/A' %></td>
              <td><%= bestTrial && worstTrial ? (parseFloat(bestTrial.accuracy) - parseFloat(worstTrial.accuracy)).toFixed(1) + '%' : 'N/A' %></td>
            </tr>
            <tr>
              <td><strong>MAE</strong></td>
              <td class="best-cell"><%= bestTrial ? bestTrial.mae : 'N/A' %></td>
              <td class="worst-cell"><%= worstTrial ? worstTrial.mae : 'N/A' %></td>
              <td><%= bestTrial && worstTrial ? (parseFloat(worstTrial.mae) - parseFloat(bestTrial.mae)).toFixed(4) : 'N/A' %></td>
            </tr>
            <tr>
              <td><strong>RMSE</strong></td>
              <td class="best-cell"><%= bestTrial ? bestTrial.rmse : 'N/A' %></td>
              <td class="worst-cell"><%= worstTrial ? worstTrial.rmse : 'N/A' %></td>
              <td><%= bestTrial && worstTrial ? (parseFloat(worstTrial.rmse) - parseFloat(bestTrial.rmse)).toFixed(4) : 'N/A' %></td>
            </tr>
            <tr>
              <td><strong>Samples</strong></td>
              <td class="best-cell"><%= bestTrial ? bestTrial.samples : 'N/A' %></td>
              <td class="worst-cell"><%= worstTrial ? worstTrial.samples : 'N/A' %></td>
              <td><%= bestTrial && worstTrial ? (bestTrial.samples - worstTrial.samples) : 'N/A' %></td>
            </tr>
          </tbody>
        </table>
        <div class="explanation">
          <h3>Matrix Explanation</h3>
          <p><strong>Accuracy:</strong> Percentage of predictions within acceptable error range. Higher is better.</p>
          <p><strong>MAE (Mean Absolute Error):</strong> Average prediction error magnitude. Lower is better.</p>
          <p><strong>RMSE (Root Mean Square Error):</strong> Square root of average squared errors, penalizing large errors more. Lower is better.</p>
          <p><strong>Samples:</strong> Training data size. More samples generally improve generalization.</p>
          <p>The <strong>difference</strong> column shows improvement from worst to best, quantifying model optimization impact.</p>
        </div>
      </div>
    </div>
  </div>
  
  <script>
    // Render bar chart with enhanced interactivity
    Plotly.newPlot('barChart', [<%- JSON.stringify(graphs.bar) %>], <%- JSON.stringify(Object.assign(graphs.barLayout, { hovermode: 'closest', showlegend: false })) %>, { responsive: true });
    
    // Render line chart with enhanced interactivity
    Plotly.newPlot('lineChart', [<%- JSON.stringify(graphs.line) %>], <%- JSON.stringify(Object.assign(graphs.lineLayout, { hovermode: 'closest', showlegend: false })) %>, { responsive: true });
    
    // Resize graphs on window resize
    window.addEventListener('resize', function() {
      Plotly.Plots.resize(document.getElementById('barChart'));
      Plotly.Plots.resize(document.getElementById('lineChart'));
    });
  </script>
</body>
</html>